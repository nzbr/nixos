name: Run Garbage Collector â™»ï¸

on:
  workflow_call: {}
  workflow_dispatch: {}

jobs:
  gc:
    name: Collect Garbage â™»ï¸
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Install nix â„ï¸
        uses: ./.github/actions/install-nix

      - name: Decrypt secrets ğŸ”“
        uses: ./.github/actions/decrypt-secrets
        with:
          secret-key: ${{ secrets.SECRET_DECRYPTION_KEY }}

      - name: Install S3 Module ğŸª£
        uses: ./.github/actions/setup-powershell

      - name: Run GC â™»ï¸
        run: nix run .#s3-collect-garbage
